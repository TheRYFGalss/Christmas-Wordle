<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Christmas Wordle</title>
<style>
  body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
  #grid { display: grid; gap: 8px; margin-top: 20px; }
  .cell { width: 40px; height: 40px; border: 2px solid #aaa; display: flex; justify-content: center; align-items: center; font-size: 20px; font-weight: bold; text-transform: uppercase; }
  .correct { background: #6aaa64; color: white; }
  .present { background: #c9b458; color: white; }
  .absent { background: #787c7e; color: white; }
  #msg { margin-top: 15px; font-size: 24px; font-weight: bold; text-align: center; }
  #keyboard { display: grid; grid-template-columns: repeat(10, 30px); gap: 5px; justify-content: center; margin-top: 20px; }
  .key { width: 30px; height: 40px; border: 1px solid #aaa; display: flex; justify-content: center; align-items: center; font-weight: bold; text-transform: uppercase; user-select: none; }
  #controls { margin-top: 20px; display: flex; align-items: center; gap: 10px; }
  #guessInput { width: 240px; height: 40px; font-size: 20px; text-transform: uppercase; text-align: center; }
  #enterBtn { padding: 5px 15px; font-size:16px; cursor:pointer; }
  #shareBtn { margin-top: 20px; display:none; padding: 10px 20px; background-color:#25D366; color:white; border:none; border-radius:5px; cursor:pointer; font-size:16px; }
</style>
</head>
<body>

<h2>Christmas Wordle</h2>

<div id="grid"></div>
<div id="msg"></div>
<div id="keyboard"></div>

<div id="controls">
  <input id="guessInput" type="text" maxlength="6" autocomplete="off" spellcheck="false" placeholder="Enter guess" />
  <button id="enterBtn">Send</button>
</div>

<button id="shareBtn">Share to WhatsApp</button>

<script>
/* ----- CONFIG ----- */
const todayWord = "Submit";
const secretWord = todayWord.toLowerCase();
const storageKey = 'christmasWordle';

/* ----- GAME STATE ----- */
const maxTries = 6;
let currentRow = 0;
let currentCol = 0;
const alphabet = "abcdefghijklmnopqrstuvwxyz";
const keyboardKeys = {};
let gridCells = [];

/* ----- GOOGLE FORM (ADDED) ----- */
function openGoogleForm(guessesTaken) {
  const today = new Date().toLocaleDateString('en-GB');

  const formUrl =
    "https://docs.google.com/forms/d/e/1FAIpQLSfNRz2jyh2cF2JVekpubNRMUTcy9NLbVq8iQweCZhIPQO0zbg/viewform?" +
    "entry.956176593=" +
    "&entry.1964866438=" + guessesTaken +
    "&entry.407786013=" + today;

  window.open(formUrl, "_blank");
}

/* ----- WORD LIST ----- */
let validWords = [];
fetch('https://raw.githubusercontent.com/dwyl/english-words/master/words_dictionary.json')
  .then(r => r.json())
  .then(d => validWords = Object.keys(d))
  .catch(() => validWords = []);

/* ----- BUILD GRID ----- */
const grid = document.getElementById("grid");
grid.style.gridTemplateColumns = `repeat(${secretWord.length}, 40px)`;

for (let r = 0; r < maxTries; r++) {
  let row = [];
  for (let c = 0; c < secretWord.length; c++) {
    const cell = document.createElement("div");
    cell.className = "cell";
    grid.appendChild(cell);
    row.push(cell);
  }
  gridCells.push(row);
}

/* ----- KEYBOARD (VISUAL ONLY) ----- */
const keyboardDiv = document.getElementById("keyboard");
for (let l of alphabet) {
  const key = document.createElement("div");
  key.className = "key";
  key.textContent = l;
  keyboardDiv.appendChild(key);
  keyboardKeys[l] = key;
}

/* ----- INPUT ----- */
const guessInput = document.getElementById("guessInput");
const enterBtn = document.getElementById("enterBtn");
const shareBtn = document.getElementById("shareBtn");

enterBtn.onclick = () => {
  const guess = guessInput.value.trim().toLowerCase();
  if (guess.length !== secretWord.length) return alert("Invalid length");
  if (validWords.length && !validWords.includes(guess)) return alert("Not a valid word");
  guessInput.value = "";
  submitGuess(guess);
};

guessInput.addEventListener("keydown", e => {
  if (e.key === "Enter") enterBtn.click();
});

/* ----- SAVE / LOAD ----- */
function saveGameState(gameOver=false) {
  localStorage.setItem(storageKey, JSON.stringify({
    secret: secretWord,
    currentRow,
    grid: gridCells.map(r => r.map(c => ({
      t: c.textContent,
      cl: c.className
    }))),
    keyboard: Object.fromEntries(
      Object.entries(keyboardKeys).map(([k,v]) => [k, v.className])
    ),
    gameOver
  }));
}

function loadGameState() {
  const raw = localStorage.getItem(storageKey);
  if (!raw) return;
  const s = JSON.parse(raw);
  if (s.secret !== secretWord) return localStorage.removeItem(storageKey);

  currentRow = s.currentRow;
  s.grid.forEach((r,i)=>r.forEach((c,j)=>{
    gridCells[i][j].textContent = c.t;
    gridCells[i][j].className = c.cl;
  }));
  Object.entries(s.keyboard).forEach(([k,v])=>keyboardKeys[k].className=v);
  if (s.gameOver) shareBtn.style.display="block";
}

/* ----- GAME LOGIC ----- */
function submitGuess(guess) {
  const counts = {};
  for (let l of secretWord) counts[l] = (counts[l]||0)+1;

  for (let i=0;i<secretWord.length;i++) {
    const cell = gridCells[currentRow][i];
    cell.textContent = guess[i];
    if (guess[i] === secretWord[i]) {
      cell.classList.add("correct");
      keyboardKeys[guess[i]].className="key correct";
      counts[guess[i]]--;
    }
  }

  for (let i=0;i<secretWord.length;i++) {
    const cell = gridCells[currentRow][i];
    if (!cell.classList.contains("correct")) {
      const l = guess[i];
      if (counts[l]>0) {
        cell.classList.add("present");
        if (!keyboardKeys[l].classList.contains("correct"))
          keyboardKeys[l].className="key present";
        counts[l]--;
      } else {
        cell.classList.add("absent");
        keyboardKeys[l].className="key absent";
      }
    }
  }

  if (guess === secretWord) {
    document.getElementById("msg").textContent = "You got it! ðŸŽ„";
    shareBtn.style.display="block";
    saveGameState(true);
    openGoogleForm(currentRow + 1);   // âœ… WIN
  } else {
    currentRow++;
    if (currentRow === maxTries) {
      saveGameState(true);
      openGoogleForm("X");            // âŒ FAIL
    } else {
      saveGameState();
    }
  }
}

/* ----- SHARE ----- */
shareBtn.onclick = () => {
  const txt = "I just completed the Christmas Wordle! ðŸŽ„";
  window.open(`https://wa.me/?text=${encodeURIComponent(txt)}`);
};

window.onload = loadGameState;
</script>
</body>
</html>
