<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Christmas Wordle</title>
<style>
  body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
  #grid { display: grid; gap: 8px; margin-top: 20px; }
  .cell { width: 40px; height: 40px; border: 2px solid #aaa; display: flex; justify-content: center; align-items: center; font-size: 20px; font-weight: bold; text-transform: uppercase; }
  .correct { background: #6aaa64; color: white; }
  .present { background: #c9b458; color: white; }
  .absent { background: #787c7e; color: white; }
  #msg { margin-top: 15px; font-size: 24px; font-weight: bold; text-align: center; }
  #keyboard { display: grid; grid-template-columns: repeat(10, 30px); gap: 5px; justify-content: center; margin-top: 20px; }
  .key { width: 30px; height: 40px; border: 1px solid #aaa; display: flex; justify-content: center; align-items: center; cursor: pointer; font-weight: bold; text-transform: uppercase; user-select: none; }
  #controls { margin-top: 20px; display: flex; align-items: center; gap: 10px; }
  #guessInput { width: 240px; height: 40px; font-size: 20px; text-transform: uppercase; text-align: center; }
  #enterBtn { padding: 5px 15px; font-size:16px; cursor:pointer; }
  #shareBtn { margin-top: 20px; display:none; padding: 10px 20px; background-color:#25D366; color:white; border:none; border-radius:5px; cursor:pointer; font-size:16px; }
</style>
</head>
<body>
<h2>Christmas Wordle</h2>

<div id="grid"></div>
<div id="msg"></div>
<div id="keyboard"></div>
<div id="controls">
  <input id="guessInput" type="text" maxlength="6" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Enter guess" />
  <button id="enterBtn">Send</button>
</div>
<button id="shareBtn">Share to WhatsApp</button>

<script>
/* ----- CONFIG ----- */
const todayWord = "Silent";           // <-- change this to start a new game
const secretWord = todayWord.toLowerCase();
const storageKey = 'christmasWordle'; // localStorage key

/* ----- GAME STATE ----- */
const maxTries = 6;
let currentRow = 0;
let currentCol = 0;
const alphabet = "abcdefghijklmnopqrstuvwxyz";
const keyboardKeys = {};
let gridCells = [];
let guessWord = Array(secretWord.length).fill('');

/* ----- WORD LIST (for validation) ----- */
let validWords = [];
fetch('https://raw.githubusercontent.com/dwyl/english-words/master/words_dictionary.json')
  .then(response => response.json())
  .then(data => { validWords = Object.keys(data); })
  .catch(() => { validWords = []; }); // fallback if fetch fails

/* ----- BUILD GRID ----- */
const grid = document.getElementById("grid");
grid.style.gridTemplateColumns = `repeat(${secretWord.length}, 40px)`;
for (let r = 0; r < maxTries; r++) {
  let rowCells = [];
  for (let c = 0; c < secretWord.length; c++) {
    let cell = document.createElement("div");
    cell.className = "cell";
    cell.id = `cell-${r}-${c}`;
    grid.appendChild(cell);
    rowCells.push(cell);
  }
  gridCells.push(rowCells);
}

/* ----- KEYBOARD (visual) ----- */
const keyboardDiv = document.getElementById("keyboard");
for (let letter of alphabet) {
  const key = document.createElement("div");
  key.className = "key";
  key.id = `key-${letter}`;
  key.textContent = letter;
  keyboardDiv.appendChild(key);
  keyboardKeys[letter] = key;
  // intentionally no click handler: visual-only keyboard
}

/* ----- DOM REFS ----- */
const guessInput = document.getElementById('guessInput');
const enterBtn = document.getElementById('enterBtn');
const shareBtn = document.getElementById("shareBtn");

/* ----- INPUT HANDLERS ----- */
enterBtn.addEventListener('click', () => {
  const guess = guessInput.value.trim().toLowerCase();
  if (guess.length !== secretWord.length) { alert('Word must be ' + secretWord.length + ' letters'); return; }
  guessInput.value = '';
  submitGuess(guess);
});

guessInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') enterBtn.click();
});

/* ----- SAVE / LOAD STATE ----- */
function saveGameState(gameOver=false) {
  const gridState = gridCells.map(row =>
    row.map(cell => ({
      letter: cell.textContent || '',
      class: cell.className.replace('cell','').trim()
    }))
  );

  const keyboardState = {};
  for (let l of alphabet) keyboardState[l] = keyboardKeys[l].className.replace('key','').trim();

  const state = {
    secret: secretWord,   // remember which secret this state belongs to
    currentRow,
    currentCol,
    grid: gridState,
    keyboard: keyboardState,
    gameOver
  };
  try { localStorage.setItem(storageKey, JSON.stringify(state)); } catch (e) { /* ignore storage errors */ }
}

function loadGameState() {
  try {
    const raw = localStorage.getItem(storageKey);
    if (!raw) return;
    const savedState = JSON.parse(raw);

    // If the saved state is for a different secret (word changed), discard it.
    if (!savedState || savedState.secret !== secretWord) {
      localStorage.removeItem(storageKey);
      return;
    }

    // restore indices
    currentRow = typeof savedState.currentRow === 'number' ? savedState.currentRow : 0;
    currentCol = typeof savedState.currentCol === 'number' ? savedState.currentCol : 0;

    // restore grid
    gridCells.forEach((row, r) => {
      row.forEach((cell, c) => {
        const cellData = savedState.grid?.[r]?.[c];
        if (cellData) {
          cell.textContent = cellData.letter || '';
          cell.className = "cell" + (cellData.class ? ' ' + cellData.class : '');
        }
      });
    });

    // restore keyboard classes
    for (let l of alphabet) {
      const keyClass = savedState.keyboard?.[l] || '';
      keyboardKeys[l].className = 'key' + (keyClass ? ' ' + keyClass : '');
    }

    if (savedState.gameOver) shareBtn.style.display = 'block';
  } catch (e) {
    // if parsing fails, remove corrupted state
    localStorage.removeItem(storageKey);
  }
}

/* ----- GAME LOGIC ----- */
function submitGuess(guess) {
  // show guess letters in the current row
  for (let i = 0; i < secretWord.length; i++) {
    gridCells[currentRow][i].textContent = guess[i] || '';
    guessWord[i] = guess[i] || '';
  }

  // validate word if list is available
  if (validWords.length && !validWords.includes(guess)) { alert("This is not a valid word!"); return; }

  // evaluate guess
  let secretCounts = {};
  for (let l of secretWord) secretCounts[l] = (secretCounts[l] || 0) + 1;

  // correct letters first
  for (let i = 0; i < secretWord.length; i++) {
    const letter = guess[i];
    if (letter === secretWord[i]) {
      gridCells[currentRow][i].classList.add("correct");
      keyboardKeys[letter].className = "key correct";
      secretCounts[letter]--;
    }
  }

  // present / absent letters
  for (let i = 0; i < secretWord.length; i++) {
    const letter = guess[i];
    if (!gridCells[currentRow][i].classList.contains("correct")) {
      if (secretCounts[letter] > 0) {
        gridCells[currentRow][i].classList.add("present");
        if (!keyboardKeys[letter].classList.contains("correct")) keyboardKeys[letter].className = "key present";
        secretCounts[letter]--;
      } else {
        gridCells[currentRow][i].classList.add("absent");
        if (!keyboardKeys[letter].classList.contains("correct") && !keyboardKeys[letter].classList.contains("present")) keyboardKeys[letter].className = "key absent";
      }
    }
  }

  // win or continue
  if (guess === secretWord) {
    document.getElementById("msg").textContent = "You got it! ðŸŽ„";
    document.getElementById("msg").style.fontSize = '32px';
    shareBtn.style.display = 'block';
    saveGameState(true);
  } else {
    currentRow++;
    currentCol = 0;
    guessWord = Array(secretWord.length).fill('');
    if (currentRow === maxTries) {
      revealSecretWord();
      saveGameState(true);
    } else {
      saveGameState();
    }
  }
}

function revealSecretWord() {
  // show secret word in the last row
  const rowToReveal = Math.max(0, currentRow - 1);
  for (let i = 0; i < secretWord.length; i++) {
    gridCells[rowToReveal][i].textContent = secretWord[i].toUpperCase();
    gridCells[rowToReveal][i].classList.add("correct");
  }
  shareBtn.style.display = 'block';
}

/* ----- SHARE BUTTON ----- */
shareBtn.onclick = () => {
  let shareText = 'I just completed the Christmas Wordle! ðŸŽ„\n';
  shareText += secretWord.toUpperCase().split('').map(l => 'ðŸŸ©').join('');
  const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(shareText)}`;
  window.open(whatsappUrl, '_blank');
};

/* ----- INITIALIZE ----- */
window.onload = function() {
  loadGameState();
};
</script>
</body>
</html>
